OlÃ¡, RedeIn! ğŸš€

Gostaria de compartilhar mais um projeto que finalizei recentemente e que pode ser Ãºtil para quem trabalha com monitoramento e automaÃ§Ã£o em ambientes Windows. A ideia deste post Ã© trocar experiÃªncias tÃ©cnicas e fortalecer nosso networking!

ğŸ“Œ O desafio: Automatizar a instalaÃ§Ã£o do Zabbix Agent em todo o nosso parque de operaÃ§Ãµes (Windows 10 e Windows 11) e garantir que cada mÃ¡quina fosse registrada automaticamente no Zabbix Server, sem necessidade de intervenÃ§Ã£o manual.

âœ… A soluÃ§Ã£o:

- Criamos uma GPO para instalar e configurar o Zabbix Agent de forma automatizada nas estaÃ§Ãµes de trabalho do domÃ­nio.
- Implementamos o Auto-Registration Actions no Zabbix Server, organizando os hosts automaticamente no Host Group: Windows Desktop.
- Garantimos que todas as novas mÃ¡quinas ingressadas no domÃ­nio sejam automaticamente adicionadas ao monitoramento.

ğŸ’» Aqui estÃ¡ o script usado no Logon Script da GPO:

@echo off
:: Define o IP do servidor Zabbix e o nome do host do computador
set ZABBIX_SERVER=[IP_DO_ZABBIX_SERVER]
set HOSTNAME=%COMPUTERNAME%
set HOSTMETADATA=Windows

:: Caminho do instalador no compartilhamento de rede
set MSI_PATH=\\IP_DO_SEU_SERVIDOR_AD\Scripts\ZabbixAgent\zabbix_agent-7.2.3-windows-amd64-openssl.msi

:: Instalar o agente silenciosamente
msiexec /i "%MSI_PATH%" /qn /norestart SERVER=%ZABBIX_SERVER% HOSTNAME=%HOSTNAME%

:: Aguarda a instalaÃ§Ã£o ser concluÃ­da
timeout /t 10 /nobreak >nul

:: Caminho do arquivo de configuraÃ§Ã£o do Zabbix Agent
set CONFIG_PATH="C:\Program Files\Zabbix Agent\zabbix_agentd.conf"

:: Remover linhas duplicadas do arquivo de configuraÃ§Ã£o
powershell -Command "(Get-Content %CONFIG_PATH% | Sort-Object -Unique) | Set-Content %CONFIG_PATH%"

:: Remover possÃ­veis mÃºltiplas ocorrÃªncias da linha 'Server=' (mantendo apenas a Ãºltima)
powershell -Command "(Get-Content %CONFIG_PATH% | Where-Object {$_ -notmatch '^Server='}) + 'Server=%ZABBIX_SERVER%' | Set-Content %CONFIG_PATH%"

:: Modificar o arquivo de configuraÃ§Ã£o para incluir os parÃ¢metros necessÃ¡rios (sem duplicidade)
(
 echo ServerActive=%ZABBIX_SERVER%
 echo HostMetadata=%HOSTMETADATA%
 echo ListenPort=10050
 echo Hostname=%HOSTNAME%
) >> %CONFIG_PATH%

:: Reiniciar o serviÃ§o do Zabbix Agent para aplicar as mudanÃ§as
net stop "Zabbix Agent" /y
net start "Zabbix Agent"

ğŸ“Š Resultado:

Agora, todas as estaÃ§Ãµes de trabalho recebem o Zabbix Agent automaticamente e aparecem na Console Web do Zabbix Server sem nenhuma configuraÃ§Ã£o manual. Mais eficiÃªncia, menos trabalho repetitivo e um monitoramento padronizado!

AlguÃ©m jÃ¡ implementou algo parecido? Alguma dica ou melhoria? Vamos trocar ideias! ğŸ’¡ğŸ”„
